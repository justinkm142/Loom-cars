import{r,a as t,j as e,B as X,c as ee,A as ae,I as te,d as se,u as re,e as le,b as v,D as ne,f as oe,o as ie,_ as O,g as ce,h as de}from"./index-0e276b34.js";function me(s){var c,d,m;const[l,i]=r.useState(0);let h=(c=s.photo[0])==null?void 0:c.images.length;return t("div",{className:"w-full h-full flex justify-center ",children:[l>0?e("div",{onClick:()=>i(l-1),className:" mx-auto my-auto  border-2 hover:bg-slate-600 active:bg-slate-800 bg-slate-400 rounded-full cursor-pointer",children:e("p",{className:"p-4 align-middle text-4xl ",children:e(X,{})})}):e("div",{className:" mx-auto my-auto rounded-full cursor-pointer",children:e("p",{className:"p-4 align-middle text-4xl "})}),e("img",{src:(m=(d=s.photo[0])==null?void 0:d.images[l])==null?void 0:m.image_url,alt:"car",className:"h-full "}),l<h-1?e("div",{onClick:()=>i(l+1),className:"mx-auto my-auto  border-2 hover:bg-slate-600 active:bg-slate-800 bg-slate-400 rounded-full cursor-pointer",children:e("p",{className:"p-4 align-middle text-4xl ",children:e(ee,{})})}):e("div",{className:"mx-auto my-auto   rounded-full cursor-pointer",children:e("p",{className:"p-4 align-middle text-4xl "})})]})}function ue(s){var l,i,h,c,d,m,g,o,p;return t("div",{className:"w-full h-full grid grid-rows-2 ",children:[t("div",{className:" p-5 pb-0",children:[t("h1",{className:"title-font text-lg font-medium text-gray-900",children:[" ",t("span",{children:[" ",(l=s.carDetails[0])==null?void 0:l.carMake," "]}),"   ",e("span",{children:(i=s.carDetails[0])==null?void 0:i.carModel})," ",t("span",{children:[" ",(h=s.carDetails[0])==null?void 0:h.manufactureYear," "]})," "]}),t("p",{className:"leading-relaxed mb-3 text-sm",children:[t("span",{children:[" ",(c=s.carDetails[0])==null?void 0:c.transmission," - "]})," ",t("span",{children:[" ",(d=s.carDetails[0])==null?void 0:d.fuelType," - "]})," ",t("span",{children:["  ",(m=s.carDetails[0])==null?void 0:m.seatCapacity,"  seats "]})," "]}),t("h2",{className:"tracking-widest text-xs title-font font-medium text-black mb-1 flex gap-1",children:[" ",t("span",{className:"text-orange-400",children:[" ",e(ae,{})," "]}),"4.88 (67 Trips)"]}),t("div",{className:"flex items-center flex-wrap mt-5 ",children:[t("h1",{className:"font-bold text-lg",children:[" â‚¹ ",t("span",{children:[" ",(g=s.carDetails[0])==null?void 0:g.rentingPrice," /Day"]})]}),t("span",{className:"text-gray-600 p-4 mr-2 inline-flex items-center ml-auto leading-none text-sm pr-3 py-1 border-2 border-gray-200",children:[e(te,{}),"  ",(o=s.carDetails[0])==null?void 0:o.availableLocation]})]})]}),t("div",{className:"p-5 pt-0 pb-3 border-2 shadow-xl rounded-xl mx-6 mb-3 mt-1",children:[e("h1",{className:"title-font text-lg font-medium text-gray-900 underline",children:" Car Feactures "}),e("div",{className:"bg-white grid grid-cols-3 mt-3 ps-20 border-2 py-3 shadow-xl rounded-xl ",children:(p=s.carDetails[0])==null?void 0:p.feature.map(f=>t("p",{className:"flex items-center",children:[e(se,{})," ",t("span",{className:"ms-2",children:[" ",f,"  "]})," "]}))})]})]})}function he(s){var _,B,E,j,A;const l=re(),i=le(a=>a.user.userId),h=(_=s.carDetails[0])==null?void 0:_._id,c=(B=s.carDetails[0])==null?void 0:B.rentingPrice;let d=(E=s.carDetails[0])==null?void 0:E.availableDates[0].startDate,m=(j=s.carDetails[0])==null?void 0:j.availableDates[0].endDate,g=(A=s.carDetails[0])==null?void 0:A.bookedDates;const[o,p]=r.useState(""),[f,S]=r.useState(""),[D,C]=r.useState();r.useState(),r.useState();const[P,F]=r.useState(),[ge,I]=r.useState(""),[b,L]=r.useState(0);r.useState("");const[z,M]=r.useState({startDate:null,endDate:null}),[y,W]=r.useState(0),[N,Y]=r.useState(!1),[w,R]=r.useState(!1),q=a=>{M(a);let n=((new Date(a.endDate)-new Date(a.startDate))/(24*60*60*1e3)+1)*c;L(n)};function J(a){return new Promise(n=>{const u=document.createElement("script");u.src=a,u.onload=()=>{n(!0)},u.onerror=()=>{n(!1)},document.body.appendChild(u)})}async function K(a,n){if(!await J("https://checkout.razorpay.com/v1/checkout.js")){alert("Razorpay SDK failed to load. Are you online?");return}const x=a;if(!x){alert("Server error. Are you online?");return}const{amount:$,id:V,currency:G}=x,H={key:"rzp_test_wqr30ojoxgZVJw",amount:$.toString(),currency:G,name:"Loom Cars",description:"Test Transaction",order_id:V,handler:async function(k){const Q={orderCreationId:V,bookingId:n,razorpayPaymentId:k.razorpay_payment_id,razorpayOrderId:k.razorpay_order_id,razorpaySignature:k.razorpay_signature},T=await v.post(`${ce}/paymentConfirm`,Q);console.log("razror pay output =>",T.data.bookingId),O.success("Vehicle Booked"),setTimeout(()=>{l("/user/bookingSuccessfull/"+T.data.bookingId)},2e3)},prefill:{name:o,email:f,contact:""+D},notes:{address:o+f},theme:{color:"#61dafb"}};new window.Razorpay(H).open()}const U=async()=>{try{let a=localStorage.getItem("token"),n=ie(a),u=await v({method:"post",url:"/booking",data:{carId:h,userId:n.userId,datesBooked:z,paymentMethod:{walletPayment:N,razorPayment:w},paymentStatus:"pending",bookingStatus:"Booked",name:o,email:f,comments:P,phone:D,amount:b,walletBalace:y}});if(u.data.message=="sucess"){let x=u.data.data._id;w?K(u.data.order,x):(O.success("Vehicle Booked"),setTimeout(()=>{l("/user/bookingSuccessfull/"+x)},2e3))}else I("Please re-try after some time")}catch(a){console.log(a),a.response.status==401&&(localStorage.clear(),l("/user/login"))}};r.useEffect(()=>{Z(i)},[]);const Z=async a=>{try{let n=await v({method:"get",url:"/userDetails",params:{userId:a}});n.data.message=="sucess"?(p(n.data.data.name),S(n.data.data.email),C(n.data.data.phone),W(n.data.data.walletBalance)):I("Please re-try after some time")}catch(n){console.log(n)}};return t("div",{className:"w-full h-full rounded-2xl ",children:[t("div",{className:"grid grid-rows-5 m-5",children:[e("h1",{className:"font-medium",children:" Booking Details "}),e("input",{onChange:a=>{p(a.target.value)},type:"text",className:"mt-5 border-2 rounded-md",placeholder:"Full Name",value:o}),e("input",{onChange:a=>{S(a.target.value)},type:"email",className:"mt-5 border-2 rounded-md",placeholder:"Email",value:f}),e("input",{onChange:a=>{C(a.target.value)},type:"number",className:"mt-5 border-2 rounded-md",placeholder:"Phone Number",value:D}),e(ne,{useRange:!1,value:z,onChange:q,placeholder:"Select Date",minDate:new Date(d),maxDate:new Date(m),inputClassName:" rounded-md  font-normal bg-white text-black w-full mt-5 h-8 border-2 ",disabledDates:g}),e("textarea",{value:P,onChange:a=>F(a.target.value),cols:"40",rows:"5",className:"mt-5 border-2 rounded-md",placeholder:"Comments"}),e("p",{className:" mt-2 text-slate-600",children:"please review the final fare "}),t("h1",{className:"text-right",children:[" Rs.",b," "]}),e("h2",{className:" font-semibold mb-3",children:"Payment Mathods "}),t("div",{className:" ms-5",children:[e("input",{disabled:y>=b&&N,type:"checkbox",id:"razerPay",name:"pay_method",value:"razerPay",className:"",checked:!(y>=b&&N)&&w,onChange:a=>R(a.target.checked)}),e("label",{for:"razerPay",className:"",children:"Razer Pay"}),e("br",{className:""}),e("input",{disabled:y==0,type:"checkbox",id:"wallet",name:"pay_method",value:"wallet",onChange:a=>{y>=b&&R(!1),Y(a.target.checked)}}),t("label",{for:"wallet",children:["Wallet Payment (Rs.",y,")"]})]}),e("button",{className:" bg-[rgb(16,163,16)] w-3/5 py-3  rounded-xl mx-auto mt-4 font-semibold text-white",onClick:U,children:"PROCEED TO PAY "})]}),e(oe,{})]})}function ye(s){const[l,i]=r.useState([]),[h,c]=r.useState("");let{vehicleId:d}=de();r.useEffect(()=>{m(d)},[]);const m=async g=>{try{let o=await v({method:"get",url:"/vehicleDetails",params:{vehicleId:g}});console.log("server respnse  is ",o),o.data.message=="sucess"?i(p=>[...o.data.result]):c("Please re-try after some time")}catch(o){console.log(o)}};return console.log("car details is ",l),e("div",{children:t("div",{className:"grid grid-rows-2 grid-flow-col gap-4 bg-[#f5f5f5]",children:[e("div",{className:"col-span-2 h-72 ms-10 mt-10 bg-white border-2 shadow-md rounded-xl ",children:e(me,{photo:l})}),e("div",{className:"col-span-2  ms-10 mb-10  bg-white border-2 shadow-md rounded-xl",children:e(ue,{carDetails:l})}),e("div",{className:"row-span-2 m-10 ms-5 border-2 bg-white rounded-xl",children:e(he,{carDetails:l})})]})})}export{ye as default};
