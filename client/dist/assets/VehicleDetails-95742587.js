import{r as s,a as t,j as e,B as ne,c as oe,A as ce,I as ie,d as de,u as me,e as ue,b as C,D as he,f as ge,o as pe,_ as V,g as fe,h as xe}from"./index-89e75b8d.js";function ye(r){var m,u,h;const[n,d]=s.useState(0);let g=(m=r.photo[0])==null?void 0:m.images.length;return t("div",{className:"w-full h-full flex justify-center ",children:[n>0?e("div",{onClick:()=>d(n-1),className:" mx-auto my-auto  border-2 hover:bg-slate-600 active:bg-slate-800 bg-slate-400 rounded-full cursor-pointer",children:e("p",{className:"p-4 align-middle text-4xl ",children:e(ne,{})})}):e("div",{className:" mx-auto my-auto rounded-full cursor-pointer",children:e("p",{className:"p-4 align-middle text-4xl "})}),e("img",{src:(h=(u=r.photo[0])==null?void 0:u.images[n])==null?void 0:h.image_url,alt:"car",className:"h-full "}),n<g-1?e("div",{onClick:()=>d(n+1),className:"mx-auto my-auto  border-2 hover:bg-slate-600 active:bg-slate-800 bg-slate-400 rounded-full cursor-pointer",children:e("p",{className:"p-4 align-middle text-4xl ",children:e(oe,{})})}):e("div",{className:"mx-auto my-auto   rounded-full cursor-pointer",children:e("p",{className:"p-4 align-middle text-4xl "})})]})}function be(r){var n,d,g,m,u,h,o,c,i;return t("div",{className:"w-full h-full grid grid-rows-2 ",children:[t("div",{className:" p-5 pb-0",children:[t("h1",{className:"title-font text-lg font-medium text-gray-900",children:[" ",t("span",{children:[" ",(n=r.carDetails[0])==null?void 0:n.carMake," "]}),"   ",e("span",{children:(d=r.carDetails[0])==null?void 0:d.carModel})," ",t("span",{children:[" ",(g=r.carDetails[0])==null?void 0:g.manufactureYear," "]})," "]}),t("p",{className:"leading-relaxed mb-3 text-sm",children:[t("span",{children:[" ",(m=r.carDetails[0])==null?void 0:m.transmission," - "]})," ",t("span",{children:[" ",(u=r.carDetails[0])==null?void 0:u.fuelType," - "]})," ",t("span",{children:["  ",(h=r.carDetails[0])==null?void 0:h.seatCapacity,"  seats "]})," "]}),t("h2",{className:"tracking-widest text-xs title-font font-medium text-black mb-1 flex gap-1",children:[" ",t("span",{className:"text-orange-400",children:[" ",e(ce,{})," "]}),"4.88 (67 Trips)"]}),t("div",{className:"flex items-center flex-wrap mt-5 ",children:[t("h1",{className:"font-bold text-lg",children:[" â‚¹ ",t("span",{children:[" ",(o=r.carDetails[0])==null?void 0:o.rentingPrice," /Day"]})]}),t("span",{className:"text-gray-600 p-4 mr-2 inline-flex items-center ml-auto leading-none text-sm pr-3 py-1 border-2 border-gray-200",children:[e(ie,{}),"  ",(c=r.carDetails[0])==null?void 0:c.availableLocation]})]})]}),t("div",{className:"p-5 pt-0 pb-3 border-2 shadow-xl rounded-xl mx-6 mb-3 mt-1",children:[e("h1",{className:"title-font text-lg font-medium text-gray-900 underline",children:" Car Feactures "}),e("div",{className:"bg-white grid grid-cols-3 mt-3 md:ps-20 border-2 py-3 shadow-xl rounded-xl ",children:(i=r.carDetails[0])==null?void 0:i.feature.map(w=>t("p",{className:"flex items-center",children:[e(de,{})," ",t("span",{className:"md:ms-2",children:[" ",w,"  "]})," "]}))})]})]})}function ve(r){var _,R,A,B,j;const n=me(),d=ue(a=>a.user.userId),g=(_=r.carDetails[0])==null?void 0:_._id,m=(R=r.carDetails[0])==null?void 0:R.rentingPrice;(A=r.carDetails[0])==null||A.availableDates[0].startDate;let u=(B=r.carDetails[0])==null?void 0:B.availableDates[0].endDate,h=(j=r.carDetails[0])==null?void 0:j.bookedDates;const[o,c]=s.useState(""),[i,w]=s.useState(""),[b,E]=s.useState();s.useState(),s.useState();const[S,Z]=s.useState(),[De,I]=s.useState(""),[v,F]=s.useState(0);s.useState("");const[f,L]=s.useState({startDate:null,endDate:null}),[x,O]=s.useState(0),[D,M]=s.useState(!1),[N,z]=s.useState(!1),[$,W]=s.useState(!1),[Y,q]=s.useState(!1),[J,K]=s.useState(!1),[U,G]=s.useState(!1),H=a=>{L(a);let l=((new Date(a.endDate)-new Date(a.startDate))/(24*60*60*1e3)+1)*m;F(l)};function Q(a){return new Promise(l=>{const p=document.createElement("script");p.src=a,p.onload=()=>{l(!0)},p.onerror=()=>{l(!1)},document.body.appendChild(p)})}async function X(a,l){if(!await Q("https://checkout.razorpay.com/v1/checkout.js")){alert("Razorpay SDK failed to load. Are you online?");return}const y=a;if(!y){alert("Server error. Are you online?");return}const{amount:k,id:T,currency:te}=y,le={key:"rzp_test_wqr30ojoxgZVJw",amount:k.toString(),currency:te,name:"Loom Cars",description:"Test Transaction",order_id:T,handler:async function(P){const se={orderCreationId:T,bookingId:l,razorpayPaymentId:P.razorpay_payment_id,razorpayOrderId:P.razorpay_order_id,razorpaySignature:P.razorpay_signature},re=await C.post(`${fe}/paymentConfirm`,se);V.success("Vehicle Booked"),setTimeout(()=>{n("/user/bookingSuccessfull/"+re.data.bookingId)},2e3)},prefill:{name:o,email:i,contact:""+b},notes:{address:o+i},theme:{color:"#61dafb"}};new window.Razorpay(le).open()}const ee=async()=>{var a;try{let l=localStorage.getItem("token");l||n("/user/login");let p=pe(l),y=await C({method:"post",url:"/booking",data:{carId:g,userId:p.userId,datesBooked:f,paymentMethod:{walletPayment:D,razorPayment:N},paymentStatus:"pending",bookingStatus:"Booked",name:o,email:i,comments:S,phone:b,amount:v,walletBalace:x}});if(y.data.message=="sucess"){let k=y.data.data._id;N?X(y.data.order,k):(V.success("Vehicle Booked"),setTimeout(()=>{n("/user/bookingSuccessfull/"+k)},2e3))}else I("Please re-try after some time")}catch(l){console.log(l),((a=l.response)==null?void 0:a.status)==401&&(localStorage.clear(),n("/user/login"))}};s.useEffect(()=>{ae(d)},[]);const ae=async a=>{try{let l=await C({method:"get",url:"/userDetails",params:{userId:a}});l.data.message=="sucess"?(c(l.data.data.name),w(l.data.data.email),E(l.data.data.phone),O(l.data.data.walletBalance)):I("Please re-try after some time")}catch(l){console.log(l)}};return t("div",{className:"w-full h-full rounded-2xl ",children:[t("div",{className:"grid grid-rows-5 m-5",children:[e("h1",{className:"font-medium",children:" Booking Details "}),e("input",{onChange:a=>{W(!/^[a-zA-Z ]{3,16}$/.test(a.target.value)),c(a.target.value)},type:"text",className:"mt-5 border-2 rounded-md ps-1",placeholder:"Full Name",value:o}),$?e("span",{className:"text-red-500 ",children:"Enter Name only "}):null,e("input",{onChange:a=>{q(!/^[A-Za-z][A-Za-z0-9_]*@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/.test(a.target.value)),w(a.target.value)},type:"email",className:"mt-5 border-2 rounded-md ps-1",placeholder:"Email",value:i}),Y?e("span",{className:"text-red-500 ",children:"Enter Email only  "}):null,e("input",{onChange:a=>{K(!/^[0-9]{10}$/.test(a.target.value)),E(a.target.value)},type:"number",className:"mt-5 border-2 rounded-md ps-1",placeholder:"Phone Number",value:b}),J?e("span",{className:"text-red-500 ",children:"Enter phone number only  "}):null,e(he,{useRange:!1,value:f,onChange:H,placeholder:"Select Date",maxDate:new Date(u),minDate:new Date(new Date().getTime()-24*60*60*1e3),inputClassName:" rounded-md  font-normal bg-white text-black w-full mt-5 h-8 border-2 ps-1 ",disabledDates:h}),e("textarea",{value:S,onChange:a=>{G(!/^[a-zA-Z0-9 \n]{5,100}$/.test(a.target.value)),Z(a.target.value)},cols:"40",rows:"5",className:"mt-5 border-2 rounded-md ps-1",placeholder:"Comments"}),U?e("span",{className:"text-red-500 ",children:"Enter Comments  "}):null,e("p",{className:" mt-2 text-slate-600",children:"please review the final fare "}),t("h1",{className:"text-right",children:[" Rs.",v," "]}),e("h2",{className:" font-semibold mb-3",children:"Payment Mathods "}),t("div",{className:" ms-5",children:[e("input",{disabled:x>=v&&D,type:"checkbox",id:"razerPay",name:"pay_method",value:"razerPay",className:"",checked:!(x>=v&&D)&&N,onChange:a=>z(a.target.checked)}),e("label",{for:"razerPay",className:"",children:"Razer Pay"}),e("br",{className:""}),e("input",{disabled:x==0,type:"checkbox",id:"wallet",name:"pay_method",value:"wallet",onChange:a=>{x>=v&&z(!1),M(a.target.checked)}}),t("label",{for:"wallet",children:["Wallet Payment (Rs.",x,")"]})]}),t("div",{class:"group flex relative",children:[e("button",{disabled:o==""||i==""||b==""||f.startDate==null||f.endDate==null||S==""||!(D||N)||!localStorage.getItem("token"),className:" bg-[rgb(16,163,16)] w-3/5 py-3  rounded-xl mx-auto mt-4 font-semibold text-white",onClick:ee,children:"PROCEED TO PAY "}),o==""||i==""||b==""||f.startDate==null||f.endDate==null||S==""||!(D||N)||!localStorage.getItem("token")?e("span",{class:`group-hover:opacity-100 transition-opacity bg-green-500 px-1 text-xl text-black rounded-md absolute left-1/2 \r
             -translate-x-1/2 translate-y-full opacity-0 mt-10 mx-auto w-full text-center`,children:localStorage.getItem("token")?"Fill the form":"Login to your account and fill the form"}):null]})]}),e(ge,{})]})}function Se(r){const[n,d]=s.useState([]),[g,m]=s.useState("");let{vehicleId:u}=xe();s.useEffect(()=>{h(u)},[]);const h=async o=>{try{let c=await C({method:"get",url:"/vehicleDetails",params:{vehicleId:o}});c.data.message=="sucess"?d(i=>[...c.data.result]):m("Please re-try after some time")}catch(c){console.log(c)}};return e("div",{children:t("div",{className:"flex flex-col md:grid md:grid-flow-col md:grid-rows-2  gap-4 bg-[#f5f5f5]",children:[e("div",{className:"md:col-span-2 h-72 mx-6 md:ms-10 p-16 md:p-0 mt-10 bg-white border-2 shadow-md rounded-xl ",children:e(ye,{photo:n})}),e("div",{className:"md:col-span-2 mx-6 md:ms-10 mb-10  bg-white border-2 shadow-md rounded-xl",children:e(be,{carDetails:n})}),e("div",{className:"md:row-span-2 mx-6 md:m-10 md:ms-5 border-2 bg-white rounded-xl",children:e(ve,{carDetails:n})})]})})}export{Se as default};
